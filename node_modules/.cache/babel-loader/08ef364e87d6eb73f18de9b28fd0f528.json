{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ContractKit = exports.newKitFromWeb3 = exports.newKitWithApiKey = exports.newKit = exports.API_KEY_HEADER_KEY = void 0;\n\nvar connect_1 = require(\"@celo/connect\");\n\nvar wallet_local_1 = require(\"@celo/wallet-local\");\n\nvar bignumber_js_1 = require(\"bignumber.js\");\n\nvar net_1 = __importDefault(require(\"net\"));\n\nvar web3_1 = __importDefault(require(\"web3\"));\n\nvar address_registry_1 = require(\"./address-registry\");\n\nvar base_1 = require(\"./base\");\n\nvar celo_tokens_1 = require(\"./celo-tokens\");\n\nvar contract_cache_1 = require(\"./contract-cache\");\n\nvar web3_contract_cache_1 = require(\"./web3-contract-cache\");\n\nexports.API_KEY_HEADER_KEY = 'apiKey';\n/**\n * Creates a new instance of `ContractKit` given a nodeUrl\n * @param url CeloBlockchain node url\n * @optional wallet to reuse or add a wallet different than the default (example ledger-wallet)\n * @optional options to pass to the Web3 HttpProvider constructor\n */\n\nfunction newKit(url, wallet, options) {\n  var web3;\n\n  if (url.endsWith('.ipc')) {\n    web3 = new web3_1.default(new web3_1.default.providers.IpcProvider(url, net_1.default));\n  } else if (url.toLowerCase().startsWith('http')) {\n    web3 = new web3_1.default(new web3_1.default.providers.HttpProvider(url, options));\n  } else {\n    web3 = new web3_1.default(url);\n  }\n\n  return newKitFromWeb3(web3, wallet);\n}\n\nexports.newKit = newKit;\n/**\n * Creates a new instance of `ContractKit` given a nodeUrl and apiKey\n * @param url CeloBlockchain node url\n * @param apiKey to include in the http request header\n * @optional wallet to reuse or add a wallet different than the default (example ledger-wallet)\n */\n\nfunction newKitWithApiKey(url, apiKey, wallet) {\n  var options = {};\n  options.headers = [];\n  options.headers.push({\n    name: exports.API_KEY_HEADER_KEY,\n    value: apiKey\n  });\n  return newKit(url, wallet, options);\n}\n\nexports.newKitWithApiKey = newKitWithApiKey;\n/**\n * Creates a new instance of the `ContractKit` with a web3 instance\n * @param web3 Web3 instance\n */\n\nfunction newKitFromWeb3(web3, wallet) {\n  if (wallet === void 0) {\n    wallet = new wallet_local_1.LocalWallet();\n  }\n\n  if (!web3.currentProvider) {\n    throw new Error('Must have a valid Provider');\n  }\n\n  return new ContractKit(new connect_1.Connection(web3, wallet));\n}\n\nexports.newKitFromWeb3 = newKitFromWeb3;\n\nvar ContractKit =\n/** @class */\nfunction () {\n  function ContractKit(connection) {\n    var _this = this;\n\n    this.connection = connection; // TODO: remove once cUSD gasPrice is available on minimumClientVersion node rpc\n\n    this.gasPriceSuggestionMultiplier = 5;\n\n    this.getHumanReadableNetworkConfig = function () {\n      return _this.getNetworkConfig(true);\n    };\n\n    this.registry = new address_registry_1.AddressRegistry(this);\n    this._web3Contracts = new web3_contract_cache_1.Web3ContractCache(this);\n    this.contracts = new contract_cache_1.WrapperCache(this);\n    this.celoTokens = new celo_tokens_1.CeloTokens(this);\n  }\n\n  ContractKit.prototype.getWallet = function () {\n    return this.connection.wallet;\n  };\n\n  ContractKit.prototype.getTotalBalance = function (address) {\n    return __awaiter(this, void 0, void 0, function () {\n      var lockedCelo, lockedBalance, pending, err_1, _a;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.contracts.getLockedGold()];\n\n          case 1:\n            lockedCelo = _b.sent();\n            return [4\n            /*yield*/\n            , lockedCelo.getAccountTotalLockedGold(address)];\n\n          case 2:\n            lockedBalance = _b.sent();\n            pending = new bignumber_js_1.BigNumber(0);\n            _b.label = 3;\n\n          case 3:\n            _b.trys.push([3, 5,, 6]);\n\n            return [4\n            /*yield*/\n            , lockedCelo.getPendingWithdrawalsTotalValue(address)];\n\n          case 4:\n            pending = _b.sent();\n            return [3\n            /*break*/\n            , 6];\n\n          case 5:\n            err_1 = _b.sent();\n            return [3\n            /*break*/\n            , 6];\n\n          case 6:\n            _a = [{\n              lockedCELO: lockedBalance,\n              pending: pending\n            }];\n            return [4\n            /*yield*/\n            , this.celoTokens.balancesOf(address)];\n\n          case 7:\n            return [2\n            /*return*/\n            , __assign.apply(void 0, _a.concat([_b.sent()]))];\n        }\n      });\n    });\n  };\n\n  ContractKit.prototype.getNetworkConfig = function (humanReadable) {\n    if (humanReadable === void 0) {\n      humanReadable = false;\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var configContracts, configMethod, configArray, configMap;\n\n      var _a;\n\n      var _this = this;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            configContracts = [base_1.CeloContract.Election, base_1.CeloContract.Attestations, base_1.CeloContract.Governance, base_1.CeloContract.LockedGold, base_1.CeloContract.SortedOracles, base_1.CeloContract.GasPriceMinimum, base_1.CeloContract.Reserve, base_1.CeloContract.Validators, base_1.CeloContract.DowntimeSlasher, base_1.CeloContract.BlockchainParameters, base_1.CeloContract.EpochRewards, base_1.CeloContract.GrandaMento];\n\n            configMethod = function (contract) {\n              return __awaiter(_this, void 0, void 0, function () {\n                var configContractWrapper, e_1;\n                return __generator(this, function (_a) {\n                  switch (_a.label) {\n                    case 0:\n                      _a.trys.push([0, 2,, 3]);\n\n                      return [4\n                      /*yield*/\n                      , this.contracts.getContract(contract)];\n\n                    case 1:\n                      configContractWrapper = _a.sent();\n\n                      if (humanReadable && 'getHumanReadableConfig' in configContractWrapper) {\n                        return [2\n                        /*return*/\n                        , configContractWrapper.getHumanReadableConfig()];\n                      } else if ('getConfig' in configContractWrapper) {\n                        return [2\n                        /*return*/\n                        , configContractWrapper.getConfig()];\n                      } else {\n                        throw new Error('No config endpoint found');\n                      }\n\n                      return [3\n                      /*break*/\n                      , 3];\n\n                    case 2:\n                      e_1 = _a.sent();\n                      return [2\n                      /*return*/\n                      , new Error(\"Failed to fetch config for contract \" + contract + \": \\n\" + e_1)];\n\n                    case 3:\n                      return [2\n                      /*return*/\n                      ];\n                  }\n                });\n              });\n            };\n\n            return [4\n            /*yield*/\n            , Promise.all(configContracts.map(configMethod))];\n\n          case 1:\n            configArray = _b.sent();\n            configMap = {};\n            configArray.forEach(function (config, index) {\n              return configMap[configContracts[index]] = config;\n            });\n            _a = {};\n            return [4\n            /*yield*/\n            , this.celoTokens.getExchangesConfigs(humanReadable)];\n\n          case 2:\n            _a.exchanges = _b.sent();\n            return [4\n            /*yield*/\n            , this.celoTokens.getStablesConfigs(humanReadable)];\n\n          case 3:\n            return [2\n            /*return*/\n            , __assign.apply(void 0, [(_a.stableTokens = _b.sent(), _a), configMap])];\n        }\n      });\n    });\n  };\n  /**\n   * Set CeloToken to use to pay for gas fees\n   * @param tokenContract CELO (GoldToken) or a supported StableToken contract\n   */\n\n\n  ContractKit.prototype.setFeeCurrency = function (tokenContract) {\n    return __awaiter(this, void 0, void 0, function () {\n      var address, _a;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            if (!(tokenContract === base_1.CeloContract.GoldToken)) return [3\n            /*break*/\n            , 1];\n            _a = undefined;\n            return [3\n            /*break*/\n            , 3];\n\n          case 1:\n            return [4\n            /*yield*/\n            , this.registry.addressFor(tokenContract)];\n\n          case 2:\n            _a = _b.sent();\n            _b.label = 3;\n\n          case 3:\n            address = _a;\n            if (!address) return [3\n            /*break*/\n            , 5];\n            return [4\n            /*yield*/\n            , this.updateGasPriceInConnectionLayer(address)];\n\n          case 4:\n            _b.sent();\n\n            _b.label = 5;\n\n          case 5:\n            this.connection.defaultFeeCurrency = address;\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  }; // TODO: remove once cUSD gasPrice is available on minimumClientVersion node rpc\n\n\n  ContractKit.prototype.updateGasPriceInConnectionLayer = function (currency) {\n    return __awaiter(this, void 0, void 0, function () {\n      var gasPriceMinimum, rawGasPrice, gasPrice;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.contracts.getGasPriceMinimum()];\n\n          case 1:\n            gasPriceMinimum = _a.sent();\n            return [4\n            /*yield*/\n            , gasPriceMinimum.getGasPriceMinimum(currency)];\n\n          case 2:\n            rawGasPrice = _a.sent();\n            gasPrice = rawGasPrice.multipliedBy(this.gasPriceSuggestionMultiplier).toFixed();\n            return [4\n            /*yield*/\n            , this.connection.setGasPriceForCurrency(currency, gasPrice)];\n\n          case 3:\n            _a.sent();\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  ContractKit.prototype.getEpochSize = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var validators, epochSize;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.contracts.getValidators()];\n\n          case 1:\n            validators = _a.sent();\n            return [4\n            /*yield*/\n            , validators.getEpochSize()];\n\n          case 2:\n            epochSize = _a.sent();\n            return [2\n            /*return*/\n            , epochSize.toNumber()];\n        }\n      });\n    });\n  };\n\n  ContractKit.prototype.getFirstBlockNumberForEpoch = function (epochNumber) {\n    return __awaiter(this, void 0, void 0, function () {\n      var epochSize;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.getEpochSize() // Follows GetEpochFirstBlockNumber from celo-blockchain/blob/master/consensus/istanbul/utils.go\n            ];\n\n          case 1:\n            epochSize = _a.sent(); // Follows GetEpochFirstBlockNumber from celo-blockchain/blob/master/consensus/istanbul/utils.go\n\n            if (epochNumber === 0) {\n              // No first block for epoch 0\n              return [2\n              /*return*/\n              , 0];\n            }\n\n            return [2\n            /*return*/\n            , (epochNumber - 1) * epochSize + 1];\n        }\n      });\n    });\n  };\n\n  ContractKit.prototype.getLastBlockNumberForEpoch = function (epochNumber) {\n    return __awaiter(this, void 0, void 0, function () {\n      var epochSize, firstBlockNumberForEpoch;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.getEpochSize() // Follows GetEpochLastBlockNumber from celo-blockchain/blob/master/consensus/istanbul/utils.go\n            ];\n\n          case 1:\n            epochSize = _a.sent(); // Follows GetEpochLastBlockNumber from celo-blockchain/blob/master/consensus/istanbul/utils.go\n\n            if (epochNumber === 0) {\n              return [2\n              /*return*/\n              , 0];\n            }\n\n            return [4\n            /*yield*/\n            , this.getFirstBlockNumberForEpoch(epochNumber)];\n\n          case 2:\n            firstBlockNumberForEpoch = _a.sent();\n            return [2\n            /*return*/\n            , firstBlockNumberForEpoch + (epochSize - 1)];\n        }\n      });\n    });\n  };\n\n  ContractKit.prototype.getEpochNumberOfBlock = function (blockNumber) {\n    return __awaiter(this, void 0, void 0, function () {\n      var epochSize, epochNumber;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.getEpochSize() // Follows GetEpochNumber from celo-blockchain/blob/master/consensus/istanbul/utils.go\n            ];\n\n          case 1:\n            epochSize = _a.sent();\n            epochNumber = Math.floor(blockNumber / epochSize);\n\n            if (blockNumber % epochSize === 0) {\n              return [2\n              /*return*/\n              , epochNumber];\n            } else {\n              return [2\n              /*return*/\n              , epochNumber + 1];\n            }\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  }; // *** NOTICE ***\n  // Next functions exists for backwards compatibility\n  // These should be consumed via connection to avoid future deprecation issues\n\n\n  ContractKit.prototype.addAccount = function (privateKey) {\n    this.connection.addAccount(privateKey);\n  };\n\n  Object.defineProperty(ContractKit.prototype, \"defaultAccount\", {\n    get: function () {\n      return this.connection.defaultAccount;\n    },\n    set: function (address) {\n      this.connection.defaultAccount = address;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(ContractKit.prototype, \"gasInflationFactor\", {\n    get: function () {\n      return this.connection.defaultGasInflationFactor;\n    },\n    set: function (factor) {\n      this.connection.defaultGasInflationFactor = factor;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(ContractKit.prototype, \"gasPrice\", {\n    get: function () {\n      return this.connection.defaultGasPrice;\n    },\n    set: function (price) {\n      this.connection.defaultGasPrice = price;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(ContractKit.prototype, \"defaultFeeCurrency\", {\n    get: function () {\n      return this.connection.defaultFeeCurrency;\n    },\n    set: function (address) {\n      this.connection.defaultFeeCurrency = address;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  ContractKit.prototype.isListening = function () {\n    return this.connection.isListening();\n  };\n\n  ContractKit.prototype.isSyncing = function () {\n    return this.connection.isSyncing();\n  };\n\n  ContractKit.prototype.fillGasPrice = function (tx) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!(tx.feeCurrency && tx.gasPrice === '0')) return [3\n            /*break*/\n            , 2];\n            return [4\n            /*yield*/\n            , this.updateGasPriceInConnectionLayer(tx.feeCurrency)];\n\n          case 1:\n            _a.sent();\n\n            _a.label = 2;\n\n          case 2:\n            return [2\n            /*return*/\n            , this.connection.fillGasPrice(tx)];\n        }\n      });\n    });\n  };\n\n  ContractKit.prototype.sendTransaction = function (tx) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2\n        /*return*/\n        , this.connection.sendTransaction(tx)];\n      });\n    });\n  };\n\n  ContractKit.prototype.sendTransactionObject = function (txObj, tx) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2\n        /*return*/\n        , this.connection.sendTransactionObject(txObj, tx)];\n      });\n    });\n  };\n\n  ContractKit.prototype.signTypedData = function (signer, typedData) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2\n        /*return*/\n        , this.connection.signTypedData(signer, typedData)];\n      });\n    });\n  };\n\n  ContractKit.prototype.stop = function () {\n    this.connection.stop();\n  };\n\n  Object.defineProperty(ContractKit.prototype, \"web3\", {\n    get: function () {\n      return this.connection.web3;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  return ContractKit;\n}();\n\nexports.ContractKit = ContractKit;","map":{"version":3,"sources":["../src/kit.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ContractKit = exports.newKitFromWeb3 = exports.newKitWithApiKey = exports.newKit = exports.API_KEY_HEADER_KEY = void 0;\nvar connect_1 = require(\"@celo/connect\");\nvar wallet_local_1 = require(\"@celo/wallet-local\");\nvar bignumber_js_1 = require(\"bignumber.js\");\nvar net_1 = __importDefault(require(\"net\"));\nvar web3_1 = __importDefault(require(\"web3\"));\nvar address_registry_1 = require(\"./address-registry\");\nvar base_1 = require(\"./base\");\nvar celo_tokens_1 = require(\"./celo-tokens\");\nvar contract_cache_1 = require(\"./contract-cache\");\nvar web3_contract_cache_1 = require(\"./web3-contract-cache\");\nexports.API_KEY_HEADER_KEY = 'apiKey';\n/**\n * Creates a new instance of `ContractKit` given a nodeUrl\n * @param url CeloBlockchain node url\n * @optional wallet to reuse or add a wallet different than the default (example ledger-wallet)\n * @optional options to pass to the Web3 HttpProvider constructor\n */\nfunction newKit(url, wallet, options) {\n    var web3;\n    if (url.endsWith('.ipc')) {\n        web3 = new web3_1.default(new web3_1.default.providers.IpcProvider(url, net_1.default));\n    }\n    else if (url.toLowerCase().startsWith('http')) {\n        web3 = new web3_1.default(new web3_1.default.providers.HttpProvider(url, options));\n    }\n    else {\n        web3 = new web3_1.default(url);\n    }\n    return newKitFromWeb3(web3, wallet);\n}\nexports.newKit = newKit;\n/**\n * Creates a new instance of `ContractKit` given a nodeUrl and apiKey\n * @param url CeloBlockchain node url\n * @param apiKey to include in the http request header\n * @optional wallet to reuse or add a wallet different than the default (example ledger-wallet)\n */\nfunction newKitWithApiKey(url, apiKey, wallet) {\n    var options = {};\n    options.headers = [];\n    options.headers.push({\n        name: exports.API_KEY_HEADER_KEY,\n        value: apiKey,\n    });\n    return newKit(url, wallet, options);\n}\nexports.newKitWithApiKey = newKitWithApiKey;\n/**\n * Creates a new instance of the `ContractKit` with a web3 instance\n * @param web3 Web3 instance\n */\nfunction newKitFromWeb3(web3, wallet) {\n    if (wallet === void 0) { wallet = new wallet_local_1.LocalWallet(); }\n    if (!web3.currentProvider) {\n        throw new Error('Must have a valid Provider');\n    }\n    return new ContractKit(new connect_1.Connection(web3, wallet));\n}\nexports.newKitFromWeb3 = newKitFromWeb3;\nvar ContractKit = /** @class */ (function () {\n    function ContractKit(connection) {\n        var _this = this;\n        this.connection = connection;\n        // TODO: remove once cUSD gasPrice is available on minimumClientVersion node rpc\n        this.gasPriceSuggestionMultiplier = 5;\n        this.getHumanReadableNetworkConfig = function () { return _this.getNetworkConfig(true); };\n        this.registry = new address_registry_1.AddressRegistry(this);\n        this._web3Contracts = new web3_contract_cache_1.Web3ContractCache(this);\n        this.contracts = new contract_cache_1.WrapperCache(this);\n        this.celoTokens = new celo_tokens_1.CeloTokens(this);\n    }\n    ContractKit.prototype.getWallet = function () {\n        return this.connection.wallet;\n    };\n    ContractKit.prototype.getTotalBalance = function (address) {\n        return __awaiter(this, void 0, void 0, function () {\n            var lockedCelo, lockedBalance, pending, err_1, _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0: return [4 /*yield*/, this.contracts.getLockedGold()];\n                    case 1:\n                        lockedCelo = _b.sent();\n                        return [4 /*yield*/, lockedCelo.getAccountTotalLockedGold(address)];\n                    case 2:\n                        lockedBalance = _b.sent();\n                        pending = new bignumber_js_1.BigNumber(0);\n                        _b.label = 3;\n                    case 3:\n                        _b.trys.push([3, 5, , 6]);\n                        return [4 /*yield*/, lockedCelo.getPendingWithdrawalsTotalValue(address)];\n                    case 4:\n                        pending = _b.sent();\n                        return [3 /*break*/, 6];\n                    case 5:\n                        err_1 = _b.sent();\n                        return [3 /*break*/, 6];\n                    case 6:\n                        _a = [{ lockedCELO: lockedBalance, pending: pending }];\n                        return [4 /*yield*/, this.celoTokens.balancesOf(address)];\n                    case 7: return [2 /*return*/, __assign.apply(void 0, _a.concat([(_b.sent())]))];\n                }\n            });\n        });\n    };\n    ContractKit.prototype.getNetworkConfig = function (humanReadable) {\n        if (humanReadable === void 0) { humanReadable = false; }\n        return __awaiter(this, void 0, void 0, function () {\n            var configContracts, configMethod, configArray, configMap;\n            var _a;\n            var _this = this;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        configContracts = [\n                            base_1.CeloContract.Election,\n                            base_1.CeloContract.Attestations,\n                            base_1.CeloContract.Governance,\n                            base_1.CeloContract.LockedGold,\n                            base_1.CeloContract.SortedOracles,\n                            base_1.CeloContract.GasPriceMinimum,\n                            base_1.CeloContract.Reserve,\n                            base_1.CeloContract.Validators,\n                            base_1.CeloContract.DowntimeSlasher,\n                            base_1.CeloContract.BlockchainParameters,\n                            base_1.CeloContract.EpochRewards,\n                            base_1.CeloContract.GrandaMento,\n                        ];\n                        configMethod = function (contract) { return __awaiter(_this, void 0, void 0, function () {\n                            var configContractWrapper, e_1;\n                            return __generator(this, function (_a) {\n                                switch (_a.label) {\n                                    case 0:\n                                        _a.trys.push([0, 2, , 3]);\n                                        return [4 /*yield*/, this.contracts.getContract(contract)];\n                                    case 1:\n                                        configContractWrapper = _a.sent();\n                                        if (humanReadable && 'getHumanReadableConfig' in configContractWrapper) {\n                                            return [2 /*return*/, configContractWrapper.getHumanReadableConfig()];\n                                        }\n                                        else if ('getConfig' in configContractWrapper) {\n                                            return [2 /*return*/, configContractWrapper.getConfig()];\n                                        }\n                                        else {\n                                            throw new Error('No config endpoint found');\n                                        }\n                                        return [3 /*break*/, 3];\n                                    case 2:\n                                        e_1 = _a.sent();\n                                        return [2 /*return*/, new Error(\"Failed to fetch config for contract \" + contract + \": \\n\" + e_1)];\n                                    case 3: return [2 /*return*/];\n                                }\n                            });\n                        }); };\n                        return [4 /*yield*/, Promise.all(configContracts.map(configMethod))];\n                    case 1:\n                        configArray = _b.sent();\n                        configMap = {};\n                        configArray.forEach(function (config, index) { return (configMap[configContracts[index]] = config); });\n                        _a = {};\n                        return [4 /*yield*/, this.celoTokens.getExchangesConfigs(humanReadable)];\n                    case 2:\n                        _a.exchanges = _b.sent();\n                        return [4 /*yield*/, this.celoTokens.getStablesConfigs(humanReadable)];\n                    case 3: return [2 /*return*/, __assign.apply(void 0, [(_a.stableTokens = _b.sent(), _a), configMap])];\n                }\n            });\n        });\n    };\n    /**\n     * Set CeloToken to use to pay for gas fees\n     * @param tokenContract CELO (GoldToken) or a supported StableToken contract\n     */\n    ContractKit.prototype.setFeeCurrency = function (tokenContract) {\n        return __awaiter(this, void 0, void 0, function () {\n            var address, _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        if (!(tokenContract === base_1.CeloContract.GoldToken)) return [3 /*break*/, 1];\n                        _a = undefined;\n                        return [3 /*break*/, 3];\n                    case 1: return [4 /*yield*/, this.registry.addressFor(tokenContract)];\n                    case 2:\n                        _a = _b.sent();\n                        _b.label = 3;\n                    case 3:\n                        address = _a;\n                        if (!address) return [3 /*break*/, 5];\n                        return [4 /*yield*/, this.updateGasPriceInConnectionLayer(address)];\n                    case 4:\n                        _b.sent();\n                        _b.label = 5;\n                    case 5:\n                        this.connection.defaultFeeCurrency = address;\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    // TODO: remove once cUSD gasPrice is available on minimumClientVersion node rpc\n    ContractKit.prototype.updateGasPriceInConnectionLayer = function (currency) {\n        return __awaiter(this, void 0, void 0, function () {\n            var gasPriceMinimum, rawGasPrice, gasPrice;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.contracts.getGasPriceMinimum()];\n                    case 1:\n                        gasPriceMinimum = _a.sent();\n                        return [4 /*yield*/, gasPriceMinimum.getGasPriceMinimum(currency)];\n                    case 2:\n                        rawGasPrice = _a.sent();\n                        gasPrice = rawGasPrice.multipliedBy(this.gasPriceSuggestionMultiplier).toFixed();\n                        return [4 /*yield*/, this.connection.setGasPriceForCurrency(currency, gasPrice)];\n                    case 3:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ContractKit.prototype.getEpochSize = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var validators, epochSize;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.contracts.getValidators()];\n                    case 1:\n                        validators = _a.sent();\n                        return [4 /*yield*/, validators.getEpochSize()];\n                    case 2:\n                        epochSize = _a.sent();\n                        return [2 /*return*/, epochSize.toNumber()];\n                }\n            });\n        });\n    };\n    ContractKit.prototype.getFirstBlockNumberForEpoch = function (epochNumber) {\n        return __awaiter(this, void 0, void 0, function () {\n            var epochSize;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.getEpochSize()\n                        // Follows GetEpochFirstBlockNumber from celo-blockchain/blob/master/consensus/istanbul/utils.go\n                    ];\n                    case 1:\n                        epochSize = _a.sent();\n                        // Follows GetEpochFirstBlockNumber from celo-blockchain/blob/master/consensus/istanbul/utils.go\n                        if (epochNumber === 0) {\n                            // No first block for epoch 0\n                            return [2 /*return*/, 0];\n                        }\n                        return [2 /*return*/, (epochNumber - 1) * epochSize + 1];\n                }\n            });\n        });\n    };\n    ContractKit.prototype.getLastBlockNumberForEpoch = function (epochNumber) {\n        return __awaiter(this, void 0, void 0, function () {\n            var epochSize, firstBlockNumberForEpoch;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.getEpochSize()\n                        // Follows GetEpochLastBlockNumber from celo-blockchain/blob/master/consensus/istanbul/utils.go\n                    ];\n                    case 1:\n                        epochSize = _a.sent();\n                        // Follows GetEpochLastBlockNumber from celo-blockchain/blob/master/consensus/istanbul/utils.go\n                        if (epochNumber === 0) {\n                            return [2 /*return*/, 0];\n                        }\n                        return [4 /*yield*/, this.getFirstBlockNumberForEpoch(epochNumber)];\n                    case 2:\n                        firstBlockNumberForEpoch = _a.sent();\n                        return [2 /*return*/, firstBlockNumberForEpoch + (epochSize - 1)];\n                }\n            });\n        });\n    };\n    ContractKit.prototype.getEpochNumberOfBlock = function (blockNumber) {\n        return __awaiter(this, void 0, void 0, function () {\n            var epochSize, epochNumber;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.getEpochSize()\n                        // Follows GetEpochNumber from celo-blockchain/blob/master/consensus/istanbul/utils.go\n                    ];\n                    case 1:\n                        epochSize = _a.sent();\n                        epochNumber = Math.floor(blockNumber / epochSize);\n                        if (blockNumber % epochSize === 0) {\n                            return [2 /*return*/, epochNumber];\n                        }\n                        else {\n                            return [2 /*return*/, epochNumber + 1];\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    // *** NOTICE ***\n    // Next functions exists for backwards compatibility\n    // These should be consumed via connection to avoid future deprecation issues\n    ContractKit.prototype.addAccount = function (privateKey) {\n        this.connection.addAccount(privateKey);\n    };\n    Object.defineProperty(ContractKit.prototype, \"defaultAccount\", {\n        get: function () {\n            return this.connection.defaultAccount;\n        },\n        set: function (address) {\n            this.connection.defaultAccount = address;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ContractKit.prototype, \"gasInflationFactor\", {\n        get: function () {\n            return this.connection.defaultGasInflationFactor;\n        },\n        set: function (factor) {\n            this.connection.defaultGasInflationFactor = factor;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ContractKit.prototype, \"gasPrice\", {\n        get: function () {\n            return this.connection.defaultGasPrice;\n        },\n        set: function (price) {\n            this.connection.defaultGasPrice = price;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ContractKit.prototype, \"defaultFeeCurrency\", {\n        get: function () {\n            return this.connection.defaultFeeCurrency;\n        },\n        set: function (address) {\n            this.connection.defaultFeeCurrency = address;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ContractKit.prototype.isListening = function () {\n        return this.connection.isListening();\n    };\n    ContractKit.prototype.isSyncing = function () {\n        return this.connection.isSyncing();\n    };\n    ContractKit.prototype.fillGasPrice = function (tx) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!(tx.feeCurrency && tx.gasPrice === '0')) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.updateGasPriceInConnectionLayer(tx.feeCurrency)];\n                    case 1:\n                        _a.sent();\n                        _a.label = 2;\n                    case 2: return [2 /*return*/, this.connection.fillGasPrice(tx)];\n                }\n            });\n        });\n    };\n    ContractKit.prototype.sendTransaction = function (tx) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.connection.sendTransaction(tx)];\n            });\n        });\n    };\n    ContractKit.prototype.sendTransactionObject = function (txObj, tx) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.connection.sendTransactionObject(txObj, tx)];\n            });\n        });\n    };\n    ContractKit.prototype.signTypedData = function (signer, typedData) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.connection.signTypedData(signer, typedData)];\n            });\n        });\n    };\n    ContractKit.prototype.stop = function () {\n        this.connection.stop();\n    };\n    Object.defineProperty(ContractKit.prototype, \"web3\", {\n        get: function () {\n            return this.connection.web3;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ContractKit;\n}());\nexports.ContractKit = ContractKit;\n//# sourceMappingURL=kit.js.map"]},"metadata":{},"sourceType":"script"}